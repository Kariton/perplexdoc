{{/*
* Calculate a range of width numbers for a responsive image 'srcset'
*
* IN: image resource map, parameter map
*
* OUT: slice of 'img' widths
*/}}

{{ $min := site.Params.imaging.min_width }}
{{ $sizes := (slice (int $min)) }}
{{ $max := .max }}
{{ $ratio := (div $max (float $min)) }}
{{ $sizestep := site.Params.imaging.sizestep }}
{{ if (lt $sizestep 10) }}
    {{ errorf "The file size difference of %d percent for your srcset is too small. You could end up with more than 100 images. At least 20 percent are recommended." $sizestep }}
{{ else if (lt $sizestep 15) }}
    {{ warnf "The file size difference of %d percent for your srcset is small. Hugo will take some time for the image processing. 20 percent or more are recommended." $sizestep }}
{{ end }}
{{ $m := (math.Sqrt (add 1 (div site.Params.imaging.sizestep 100.0))) }}
{{ $n := (math.Ceil (div (math.Log $ratio) (math.Log $m))) }}
{{ $mo := (math.Pow $ratio (div 1.0 $n)) }}
{{ $size := $min }}
{{ range (seq 1 (int $n)) }}
    {{ $size = (mul $size $mo) }}
    {{ $sizes = $sizes | append (int (math.Round $size)) }}
{{ end }}
{{ return $sizes }}
